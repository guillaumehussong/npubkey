<mat-card class="post" *ngIf="post">
    <mat-card-header>
        <img 
            *ngIf="post.picture"
            class="header-image"
            routerLink="/users/{{post.pubkey|npub}}"
            mat-card-avatar
            src="{{post.picture}}"/>
        <mat-card-subtitle routerLink="/users/{{post.pubkey|npub}}">
            <div class="username">{{post.pubkey|username|ellipsis}}</div>
        </mat-card-subtitle>
        <div class="more-vert">
            <button mat-icon-button [matMenuTriggerFor]="menu" color="primary">
                <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="showEventJson()">
                    <span>Event Json</span>
                </button>
            </mat-menu>
        </div>
        <mat-card-subtitle>{{post.fromNow}}</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
        <div>
            <span class="extras" routerLink="/posts/{{post.nostrEventId}}">id: {{post.nostrEventId|ellipsis}}</span>
        </div>
        <div *ngIf="post.nip10Result.profiles && post.nip10Result.profiles.length > 0">
            <span class="extras">users: </span>
            <span 
                *ngFor="let profile of post.nip10Result.profiles"
                routerLink="/users/{{profile.pubkey|npub}}"
                class="extras">
            {{profile.pubkey|username|ellipsis}}
            </span>
        </div>
        <div *ngIf="post.nip10Result.reply">
            <span class="extras">re: </span>
            <span routerLink="/posts/{{post.nip10Result.reply.id|nevent}}" class="extras">{{post.nip10Result.reply.id|nevent|ellipsis}}</span>
        </div>
        <div *ngIf="post.nip10Result.root && !viewingRoot">
            <span class="extras">root: </span>
            <span routerLink="/posts/{{post.nip10Result.root.id|nevent}}" class="extras">{{post.nip10Result.root.id|nevent|ellipsis}}</span>
        </div>
        <div *ngIf="smallScreen" class="small-post-content-container">
            <p class="post-content" [innerHTML]="post.content | safe" (click)="processLinks($event)"></p>
        </div>
        <div *ngIf="!smallScreen" class="large-post-content-container">
            <p class="post-content" [innerHTML]="post.content | safe" (click)="processLinks($event)"></p>
        </div>
    </mat-card-content>
    <div fxLayout="row" fxLayoutAlign="space-around center">
        <div fxLayout="row" class="click-icon">
            <mat-icon (click)="clickShowReplyForm()">mode_comment</mat-icon>
            <span *ngIf="post.replyCount > 0">{{post.replyCount}}</span>
        </div>
        <div (click)="repost()" class="click-icon">
            <mat-icon>autorenew</mat-icon>
        </div>
        <div fxLayout="row" (click)="zap()" class="click-icon">
            <mat-icon>bolt</mat-icon>
            <span *ngIf="zapsCount">{{zapsCount}}</span>
        </div>
        <div (click)="copyLink()" class="click-icon">
            <mat-icon>share</mat-icon>
        </div>
        <div routerLink="/posts/{{post.noteId|nevent}}" class="click-icon">
            <mat-icon>open_in_full</mat-icon>
        </div>
    </div>
    <div *ngIf="showReplyForm">
        <p>
            <mat-card-content fxLayout="row" fxLayoutAlign="space-evenly">
                <mat-form-field appearance="outline">
                    <mat-label>Reply</mat-label>
                    <input matInput [(ngModel)]="replyContent" placeholder="message">
                </mat-form-field>
                <br>
                <button mat-icon-button color="primary" (click)="sendReply()">
                    <mat-icon>send</mat-icon>
                </button>
            </mat-card-content>
        </p>
    </div>
    <div *ngIf="showZapForm">
        <p>
            <mat-card-content fxLayout="row">
                <mat-form-field appearance="outline" fxFlex='90'>
                    <mat-label>Sats</mat-label>
                    <input matInput [(ngModel)]="sats" placeholder="sats">
                </mat-form-field>
                <button mat-fab (click)="sendZap()">
                    <mat-icon>bolt</mat-icon>
                </button>
            </mat-card-content>
        </p>
    </div>
    <div *ngIf="paymentInvoice && showInvoiceSection" class="invoice">
        <div class="invoice-title">
            <h2>Invoice</h2>
            <mat-divider></mat-divider>
            <br>
        </div>
        <div class="lightning-buttons" fxLayoutAlign="space-evenly center">
            <button mat-fab color="primary" (click)="copyInvoice()">
                <mat-icon>content_copy</mat-icon>
            </button>
            <button mat-fab color="accent" (click)="showQRCode()">
                <mat-icon>qr_code_2</mat-icon>
            </button>
            <button mat-fab color="warn" (click)="hideInvoice()">
                <mat-icon>close</mat-icon>
            </button>
        </div>
        <p *ngIf="displayQRCode" class="qrcode" >
            <span>Scan with phone to pay ({{invoiceAmount}} sats)</span>
            <mat-divider></mat-divider>
            <qrcode [qrdata]="paymentInvoice" [colorDark]="'#800080'" [imageSrc]="'https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0'" [title]="'Lightning Invoice'" [errorCorrectionLevel]="'M'"></qrcode>
        </p>
    </div>
    <p>
        <mat-divider></mat-divider>
    </p>
</mat-card>